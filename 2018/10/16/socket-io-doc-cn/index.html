<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Socket.IO中文文档 | 小窝儿</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-121076594-1','auto');ga('send','pageview');
</script><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({google_ad_client: "ca-pub-3612358974879559", enable_page_level_ads: true);</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Socket.IO中文文档</h1><a id="logo" href="/.">小窝儿</a><p class="description">xiaolei的个人博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Socket.IO中文文档</h1><div class="post-meta">Oct 16, 2018<span> | </span><span class="category"><a href="/categories/服务器相关/">服务器相关</a></span></div><a class="disqus-comment-count" href="/2018/10/16/socket-io-doc-cn/#vcomment"><span class="valine-comment-count" data-xid="/2018/10/16/socket-io-doc-cn/"></span><span> 条评论</span></a><div class="post-content"><p>尝试翻译socket.io官方文档, 没有时间线, 不知道何时完成…</p>
<p>水平有限, 如果有人看到, 并且发现其中错误, 欢迎您给我指出, 谢谢!<br><a id="more"></a></p>
<hr>
<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul>
<li><a href="#目录">目录</a></li>
<li><a href="#概述">概述</a><ul>
<li><a href="#socketio是什么">Socket.IO是什么</a><ul>
<li><a href="#可靠性">可靠性</a></li>
<li><a href="#支持自动重连">支持自动重连</a></li>
<li><a href="#断线检测">断线检测</a></li>
<li><a href="#支持二进制">支持二进制</a></li>
<li><a href="#支持多路技术待翻译">支持多路技术(待翻译)</a></li>
<li><a href="#支持房间模式">支持房间模式</a></li>
</ul>
</li>
<li><a href="#socketio不是什么">Socket.IO不是什么</a></li>
<li><a href="#socketio的安装">Socket.IO的安装</a><ul>
<li><a href="#服务器">服务器</a></li>
<li><a href="#javascript客户端">JavaScript客户端</a></li>
<li><a href="#其他的客户端实现">其他的客户端实现</a></li>
</ul>
</li>
<li><a href="#与http模块搭配使用">与http模块搭配使用</a><ul>
<li><a href="#服务器appjs">服务器(app.js)</a></li>
<li><a href="#客户端indexhtml">客户端(index.html)</a></li>
</ul>
</li>
<li><a href="#与express模块搭配使用">与express模块搭配使用</a><ul>
<li><a href="#服务器appjs">服务器(app.js)</a></li>
<li><a href="#客户端indexhtml">客户端(index.html)</a></li>
</ul>
</li>
<li><a href="#发送和接收事件">发送和接收事件</a><ul>
<li><a href="#服务器">服务器</a></li>
</ul>
</li>
<li><a href="#restricting-yourself-to-a-namespace待翻译">Restricting yourself to a namespace(待翻译)</a></li>
<li><a href="#sending-volatile-messages待翻译">Sending volatile messages(待翻译)</a></li>
<li><a href="#发送和获取数据acknowledgements待翻译">发送和获取数据(acknowledgements)(待翻译)</a></li>
<li><a href="#广播消息">广播消息</a><ul>
<li><a href="#服务器">服务器</a></li>
</ul>
</li>
<li><a href="#作为跨浏览器的websocket使用它">作为跨浏览器的WebSocket使用它</a><ul>
<li><a href="#服务器appjs">服务器(app.js)</a></li>
<li><a href="#客户端indexhtml">客户端(index.html)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="Socket-IO是什么"><a href="#Socket-IO是什么" class="headerlink" title="Socket.IO是什么"></a>Socket.IO是什么</h2><p>Socket.IO是浏览器与服务器之间的实时的、双向性的、基于事件的通讯库，它由两部分组成：</p>
<ul>
<li>Node.js服务器：<a href="https://github.com/socketio/socket.io" target="_blank" rel="noopener">源码</a> | <a href="https://socket.io/docs/server-api/" target="_blank" rel="noopener">API</a></li>
<li>供浏览器使用的Javascript库(也可以在Node.js中运行)：<a href="https://github.com/socketio/socket.io-client" target="_blank" rel="noopener">源码</a> | <a href="https://socket.io/docs/client-api/" target="_blank" rel="noopener">API</a></li>
</ul>
<p>它的主要特点是：</p>
<h3 id="可靠性"><a href="#可靠性" class="headerlink" title="可靠性"></a>可靠性</h3><p>即使在以下情况下依然可以建立链接：</p>
<ul>
<li>有代理和负载均衡。</li>
<li>个人防火墙和杀毒软件。</li>
</ul>
<p>为了达到这个目的， Socket.IO依赖于 <a href="https://github.com/socketio/engine.io" target="_blank" rel="noopener">Engine.IO</a>，先建立一个长轮询连接，然后尝试将其升级为经测试过更可靠的传输方式， 比如WebSocket。更多信息请访问 <a href="https://github.com/socketio/engine.io#goals" target="_blank" rel="noopener">Goals</a> 板块.</p>
<h3 id="支持自动重连"><a href="#支持自动重连" class="headerlink" title="支持自动重连"></a>支持自动重连</h3><p>除非被通知，否则一个断开连接的客户端会一直尝试重新连接服务器， 知道服务器再次可用。请在 <a href="https://socket.io/docs/client-api/#new-Manager-url-options" target="_blank" rel="noopener">这里</a> 查看可用的重连选项。</p>
<h3 id="断线检测"><a href="#断线检测" class="headerlink" title="断线检测"></a>断线检测</h3><p>在Engine.IO层面实现了心跳机制，允许客户端和服务器双方都能知道另一方是否不再响应。</p>
<p>这个功能是通过在服务端和客户端设置的计时器实现的，在连接建立是的握手阶段通过超时值共享（参数pingInterval和pingTimeout）。Those timers require any subsequent client calls to be directed to the same server, hence the sticky-session requirement when using multiples nodes.</p>
<h3 id="支持二进制"><a href="#支持二进制" class="headerlink" title="支持二进制"></a>支持二进制</h3><p>所有可以序列化的数据结构都可以发送，包括：</p>
<ul>
<li>浏览器中的 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" target="_blank" rel="noopener">ArrayBuffer</a> 和 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" target="_blank" rel="noopener">Blob</a></li>
<li>Node.js中的 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" target="_blank" rel="noopener">ArrayBuffer</a> 和 <a href="https://nodejs.org/api/buffer.html" target="_blank" rel="noopener">Buffer</a><h3 id="支持多路技术-待翻译"><a href="#支持多路技术-待翻译" class="headerlink" title="支持多路技术(待翻译)"></a>支持多路技术(待翻译)</h3>In order to create separation of concerns within your application (for example per module, or based on permissions), Socket.IO allows you to create several Namespaces, which will act as separate communication channels but will share the same underlying connection.<h3 id="支持房间模式"><a href="#支持房间模式" class="headerlink" title="支持房间模式"></a>支持房间模式</h3>在任一命名空间内，你可以定义任意的频道， 我们称之为房间（Rooms），socket连接可以加入或离开放假。你可以向一个指定的房间广播消息，所有加入该房间的客户端都会受到广播消息。</li>
</ul>
<p>这是一个很有用的功能， 可以向一个群组的用户或者连接到多个设备的指定用户发送通知。</p>
<p>这些功能都有一个简单方便的API，例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>)</span>&#123;</span><br><span class="line">    socket.emit(<span class="string">'request'</span>, <span class="comment">/* */</span>); <span class="comment">//向socket连接发送事件</span></span><br><span class="line">    io.emit(<span class="string">'broadcast'</span>, <span class="comment">/* */</span>); <span class="comment">//向所有连接发送事件</span></span><br><span class="line">    socket.on(<span class="string">'reply'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* */</span> &#125;;); <span class="comment">//监听reply事件</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="Socket-IO不是什么"><a href="#Socket-IO不是什么" class="headerlink" title="Socket.IO不是什么"></a>Socket.IO不是什么</h2><p>Socket.IO <strong>不是</strong> WebSocket的一种实现方法。虽然Socket.IO确实在WebSocket可用的时候使用其作为传输方式，它向每一个数据包添加了一些元数据：数据包类型（packet type）、命名空间（namespace）和确认id（ack id）如果需要消息确认的话。这就是为什么一个WebSocket客户端不能连接到Socket.IO服务器， 反过来一个Socket.IO客户端也不能连接到WebSocket服务器。请在<a href="https://github.com/socketio/socket.io-protocol" target="_blank" rel="noopener">这里</a>查看协议规范。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 警告：客户端不能连接！</span></span><br><span class="line"><span class="keyword">const</span> client = io(<span class="string">'ws://echo.websocket.org'</span>);</span><br></pre></td></tr></table></figure></p>
<h2 id="Socket-IO的安装"><a href="#Socket-IO的安装" class="headerlink" title="Socket.IO的安装"></a>Socket.IO的安装</h2><h3 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save socket.io</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/socketio/socket.io" target="_blank" rel="noopener">查看源码</a></p>
<h3 id="JavaScript客户端"><a href="#JavaScript客户端" class="headerlink" title="JavaScript客户端"></a>JavaScript客户端</h3><p>默认在服务端中提供的/socket.io/socket.io.js文件。</p>
<p>也可以从某个CDN上获取，比如 <a href="https://cdnjs.com/libraries/socket.io" target="_blank" rel="noopener">cdnjs</a></p>
<p>若果要在Node.js中使用，或者搭配像 <a href="https://webpack.js.org/" target="_blank" rel="noopener">webpack</a> 或者 <a href="http://browserify.org/" target="_blank" rel="noopener">browserify</a> 这样的工具包使用，可以通过npm来安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save socket.io-client</span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/socketio/socket.io-client" target="_blank" rel="noopener">查看源码</a></p>
<h3 id="其他的客户端实现"><a href="#其他的客户端实现" class="headerlink" title="其他的客户端实现"></a>其他的客户端实现</h3><p>还有一些其他语言的客户端实现，它们是由社区维护的：</p>
<ul>
<li>Java: <a href="https://github.com/socketio/socket.io-client-java" target="_blank" rel="noopener">https://github.com/socketio/socket.io-client-java</a></li>
<li>C++: <a href="https://github.com/socketio/socket.io-client-cpp" target="_blank" rel="noopener">https://github.com/socketio/socket.io-client-cpp</a></li>
<li>Swift: <a href="https://github.com/socketio/socket.io-client-swift" target="_blank" rel="noopener">https://github.com/socketio/socket.io-client-swift</a></li>
<li>Dart: <a href="https://github.com/rikulo/socket.io-client-dart" target="_blank" rel="noopener">https://github.com/rikulo/socket.io-client-dart</a></li>
<li>Python: <a href="https://github.com/invisibleroads/socketIO-client" target="_blank" rel="noopener">https://github.com/invisibleroads/socketIO-client</a></li>
<li>.Net: <a href="https://github.com/Quobject/SocketIoClientDotNet" target="_blank" rel="noopener">https://github.com/Quobject/SocketIoClientDotNet</a><h2 id="与http模块搭配使用"><a href="#与http模块搭配使用" class="headerlink" title="与http模块搭配使用"></a>与http模块搭配使用</h2><h3 id="服务器-app-js"><a href="#服务器-app-js" class="headerlink" title="服务器(app.js)"></a>服务器(app.js)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(handler);</span><br><span class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(app);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">80</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handler</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    fs.readFile(__dirname + <span class="string">'/index.html'</span>,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(err) &#123;</span><br><span class="line">                res.writeHead(<span class="number">500</span>);</span><br><span class="line">                <span class="keyword">return</span> res.end(<span class="string">'Error loading index.html'</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            res.writeHead(<span class="number">200</span>);</span><br><span class="line">            res.end(data);</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    socket.emit(<span class="string">'news'</span>, &#123; <span class="attr">hello</span>: <span class="string">'world'</span> &#125;);</span><br><span class="line">    socket.on(<span class="string">'my other event'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="客户端-index-html"><a href="#客户端-index-html" class="headerlink" title="客户端(index.html)"></a>客户端(index.html)</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/socket.io/socket.io.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> socket = io(<span class="string">'http://localhost'</span>);</span></span><br><span class="line"><span class="javascript">    socket.on(<span class="string">'news'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(data);</span></span><br><span class="line"><span class="javascript">        socket.emit(<span class="string">'my other event'</span>, &#123; <span class="attr">my</span>: <span class="string">'data'</span> &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="与express模块搭配使用"><a href="#与express模块搭配使用" class="headerlink" title="与express模块搭配使用"></a>与express模块搭配使用</h2><h3 id="服务器-app-js-1"><a href="#服务器-app-js-1" class="headerlink" title="服务器(app.js)"></a>服务器(app.js)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</span><br><span class="line"><span class="keyword">var</span> server = <span class="built_in">require</span>(<span class="string">'http'</span>).Server(app);</span><br><span class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(server);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">80</span>);</span><br><span class="line"><span class="comment">//注意: app.listen(80)在这里不可用</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.sendFile(__dirname + <span class="string">'/index.html'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    socket.emit(<span class="string">'news'</span>, &#123; <span class="attr">hellp</span>: <span class="string">'world'</span> &#125;);</span><br><span class="line">    socket.on(<span class="string">'my other event'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="客户端-index-html-1"><a href="#客户端-index-html-1" class="headerlink" title="客户端(index.html)"></a>客户端(index.html)</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/socket.io/socket.io.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> socket = io.connect(<span class="string">'http://localhost'</span>);</span></span><br><span class="line"><span class="javascript">    socket.on(<span class="string">'news'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(data);</span></span><br><span class="line"><span class="javascript">        socket.emit(<span class="string">'my other event'</span>, &#123; <span class="attr">my</span>: <span class="string">'data'</span> &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="发送和接收事件"><a href="#发送和接收事件" class="headerlink" title="发送和接收事件"></a>发送和接收事件</h2><p>Socket.IO允许你发送和接收自定义事件。除 <strong><em>connect</em></strong> 、<strong><em>message</em></strong> 、<strong><em>disconnect</em></strong>之外，你可以发送自定义事件：</p>
<h3 id="服务器-1"><a href="#服务器-1" class="headerlink" title="服务器"></a>服务器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//io(&lt;端口&gt;)会创建一个http服务器</span></span><br><span class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(<span class="number">80</span>);</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    io.emit(<span class="string">'this'</span>, &#123; <span class="attr">will</span>: <span class="string">'be received by everyone'</span> &#125;);</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'private message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">from, msg</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'I received a private message by '</span>, <span class="keyword">from</span>, <span class="string">' saying '</span>, msg);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'disconnect'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        io.emit(<span class="string">'user disconnected'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Restricting-yourself-to-a-namespace-待翻译"><a href="#Restricting-yourself-to-a-namespace-待翻译" class="headerlink" title="Restricting yourself to a namespace(待翻译)"></a>Restricting yourself to a namespace(待翻译)</h2><h2 id="Sending-volatile-messages-待翻译"><a href="#Sending-volatile-messages-待翻译" class="headerlink" title="Sending volatile messages(待翻译)"></a>Sending volatile messages(待翻译)</h2><h2 id="发送和获取数据-acknowledgements-待翻译"><a href="#发送和获取数据-acknowledgements-待翻译" class="headerlink" title="发送和获取数据(acknowledgements)(待翻译)"></a>发送和获取数据(acknowledgements)(待翻译)</h2><h2 id="广播消息"><a href="#广播消息" class="headerlink" title="广播消息"></a>广播消息</h2><p>如需广播消息，只需要在调用 <strong><em>emit</em></strong> 和 <strong><em>send</em></strong> 方法之前添加 <strong><em>broadcast</em></strong> 标记即可。广播的意思是向除发起广播之外的所有客户端发送消息。</p>
<h3 id="服务器-2"><a href="#服务器-2" class="headerlink" title="服务器"></a>服务器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(<span class="number">80</span>);</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    socket.broadcast.emit(<span class="string">'user connected'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="作为跨浏览器的WebSocket使用它"><a href="#作为跨浏览器的WebSocket使用它" class="headerlink" title="作为跨浏览器的WebSocket使用它"></a>作为跨浏览器的WebSocket使用它</h2><p>当然你也可以只是用标准的WebSocket语法。只使用 <strong><em>send</em></strong> 方法并且监听 <strong><em>message</em></strong> 事件即可：</p>
<h3 id="服务器-app-js-2"><a href="#服务器-app-js-2" class="headerlink" title="服务器(app.js)"></a>服务器(app.js)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(<span class="number">80</span>);</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    socket.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;);</span><br><span class="line">    socket.on(<span class="string">'disconnect'</span>, fuction() &#123;&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="客户端-index-html-2"><a href="#客户端-index-html-2" class="headerlink" title="客户端(index.html)"></a>客户端(index.html)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> socket = io(<span class="string">'http://localhost/'</span>);</span><br><span class="line">    socket.on(<span class="string">'connect'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        socket.send(<span class="string">'hi'</span>);</span><br><span class="line">        socket.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123; &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果你不关心诸如重连逻辑之类的事情，可以看一下 <a href="https://github.com/socketio/engine.io" target="_blank" rel="noopener">Engine.IO</a>，这是Socket.IO使用的WebSocket语法的传输层。</p>
</div><iframe src="/donate/?AliPayQR=/img/AliPayQR.png&amp;WeChatQR=/img/WeChatQR.png&amp;GitHub=https://github.com/sjzlei1989&amp;BTCQR=null&amp;BTCKEY=null&amp;PayPal=null" style="overflow-x:hidden; overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><div class="tags"><a href="/tags/socket/">socket</a><a href="/tags/socket-io/">socket.io</a><a href="/tags/文档/">文档</a></div><div class="post-nav"><a class="pre" href="/2018/10/19/2018-10-19/">2018-10-19</a><a class="next" href="/2018/07/18/typescript-random-number/">Typescript生成随机数</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'NmDbUKyhz8giXbHpRlPzzPEH-gzGzoHsz',
  appKey:'wy664Kqxdz45SFEXQ1CRGxiY',
  placeholder:'Just so so',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://xleilei.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/typescript/">typescript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器相关/">服务器相关</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/流水账记梦/">流水账记梦</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/c-11/" style="font-size: 15px;">c++11</a> <a href="/tags/梦/" style="font-size: 15px;">梦</a> <a href="/tags/npt-server/" style="font-size: 15px;">npt server</a> <a href="/tags/sync-time/" style="font-size: 15px;">sync time</a> <a href="/tags/net-time/" style="font-size: 15px;">net time</a> <a href="/tags/vba/" style="font-size: 15px;">vba</a> <a href="/tags/utf-8/" style="font-size: 15px;">utf-8</a> <a href="/tags/输出/" style="font-size: 15px;">输出</a> <a href="/tags/c/" style="font-size: 15px;">c++</a> <a href="/tags/cpp/" style="font-size: 15px;">cpp</a> <a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/lambda/" style="font-size: 15px;">lambda</a> <a href="/tags/ts/" style="font-size: 15px;">ts</a> <a href="/tags/typescript/" style="font-size: 15px;">typescript</a> <a href="/tags/random/" style="font-size: 15px;">random</a> <a href="/tags/随机数/" style="font-size: 15px;">随机数</a> <a href="/tags/字符串/" style="font-size: 15px;">字符串</a> <a href="/tags/string/" style="font-size: 15px;">string</a> <a href="/tags/socket/" style="font-size: 15px;">socket</a> <a href="/tags/socket-io/" style="font-size: 15px;">socket.io</a> <a href="/tags/文档/" style="font-size: 15px;">文档</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/12/01/android-sync-time/">安卓修改ntp服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/20/2018-10-20/">2018-10-20</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/19/2018-10-19/">2018-10-19</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/16/socket-io-doc-cn/">Socket.IO中文文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/18/typescript-random-number/">Typescript生成随机数</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/20/cpp11-lambda/">C++ 11中的lambda表达式解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/20/cpp-string-operation/">C++字符串操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/19/vba-out-utf8/">使用VBA输出UTF-8</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">小窝儿.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="50" src="//cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>